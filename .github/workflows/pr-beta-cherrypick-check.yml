name: Require beta cherry-pick consideration
concurrency:
  group: Require-Beta-Cherrypick-Consideration-${{ github.workflow }}-${{ github.head_ref || github.event.workflow_run.head_branch || github.run_id }}
  cancel-in-progress: true

on:
  pull_request:
    types: [opened, edited, reopened, synchronize]

permissions:
  contents: read

jobs:
  beta-cherrypick-check:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
      - name: Check PR body for beta cherry-pick consideration
        env:
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          if echo "$PR_BODY" | grep -qiE "\\[x\\][[:space:]]*\\[Required\\][[:space:]]*I have considered whether this PR needs to be cherry[- ]picked to the latest beta branch"; then
            echo "Cherry-pick consideration box is checked. Check passed."
            exit 0
          fi

          echo "::error::Please check the 'I have considered whether this PR needs to be cherry-picked to the latest beta branch' box in the PR description."
          exit 1
